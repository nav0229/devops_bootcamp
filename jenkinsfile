pipeline {
    agent any
    environment {
    BRANCH_ENV = "test"
        }
    stages {
		stage ("Env Info") {
			when {
				anyOf {
					changeRequest target: "test";
					changeRequest target: "uat";
					changeRequest target: "rel_1.0";
					branch "test";
					branch "uat"
					branch "rel_1.0"
				}
			}
			stages {
				stage("Fetch Branches") {
					when {
						branch "test";
						branch "uat"
						branch "rel_1.0"
					}
					steps {
						sh '''
							git config --add remote.origin.fetch +refs/heads/${BRANCH_ENV}:refs/remotes/origin/${BRANCH_ENV}
							git fetch --no-tags
						'''
					}
				}

        
    }
}

	stage("Find delta") {
					steps {
						sh "rm -Rf diff"
						sh "git clone https://github.com/nav0229/diff.git"
						dir ("diff") {
						sh "npm link"}
						//sh " git checkout uat"
						//sh " git checkout rel_1.0"
						//sh "sfpackage test rel_1.0 -p 55 ./Deploy/"
						//sh "npm install -g /c/Softwares/sfpackager"
						//sh " /c/Softwares/sfpackager/index.js uat rel_1.0 ./deploy"
						
						}
}
	stage("JWT Auth + Validate") {
					steps {
						sh '''
						sfdx version
						ls -l C:/certificate/server.key
						sfdx auth:jwt:grant --clientid 3MVG9SM6_sNwRXqv87fhnI9wtafC.ppK3YSLiD.Ccf55M9wRk1ks54KUGfVYPKsQoNCNfGEuMbU15hPRXgGV4 --jwtkeyfile C:/certificate/new-cert/server.key --username navdeep.singh@salesforce.com.csgdevops.ndev2 --instanceurl https://test.salesforce.com;
						
						'''
						}
}

}
}
