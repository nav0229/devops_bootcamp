pipeline {
    agent any
    environment {
    BRANCH_ENV = test
    }
    tools {node.js "node 16x LTS"}
    	stages {
		stage ("Build") {
			when {
				anyOf {
					changeRequest target: "test";
					changeRequest target: "uat";
					branch "test";
					branch "uat"
				}
			}
			stages {
				stage("Fetch Environment Branches") {
					when {
						branch "test";
						branch "uat"
					}
					steps {
						sh '''
							git config --add remote.origin.fetch +refs/heads/${BRANCH_ENV}:refs/remotes/origin/${BRANCH_ENV}
							git fetch --no-tags
						'''
					}
				}

        
    }
}

	stage("Find delta") {
					steps {
						sh "rm -Rf diff"
						sh "node --version"
						sh "npm --version"
						sh "git clone https://github.com/nav0229/diff.git"
						dir ("diff") {
							sh "npm link"
									}
						sh "sfpackage origin/test origin/rel_1.0 -p Deploy"
						//setHasMetadataTypes()


						}
}
}
}
